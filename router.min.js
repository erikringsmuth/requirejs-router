define([],function(){"use strict";var t={},e={statechange:[],routeload:[]},n=0,r=0,i=function(){n>=r?(n+=1,o.fire("statechange")):n=r},a=function(){r>=n?(r+=1,o.fire("statechange")):r=n},o={init:function(t){return"undefined"==typeof t&&(t={}),window.addEventListener?(window.addEventListener("popstate",i,!1),window.addEventListener("hashchange",a,!1)):(window.attachEvent("popstate",i),window.attachEvent("onhashchange",a)),t.loadCurrentRouteOnStateChange!==!1&&o.on("statechange",function(){o.loadCurrentRoute()}),t.triggerInitialStateChange!==!1&&o.fire("statechange"),o},registerRoutes:function(t){for(var e in t)t.hasOwnProperty(e)&&(o.routes[e]=t[e]);return o},routes:{},activeRoute:{},on:function(t,n){return"undefined"==typeof e[t]&&(e[t]=[]),e[t].push(n),o},fire:function(t){if(e[t])for(var n=Array.prototype.slice.call(arguments,1),r=0;r<e[t].length;r++)e[t][r].apply(o,n)},off:function(t,n){if(e[t]){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},loadCurrentRoute:function(){for(var t in o.routes)if(o.routes.hasOwnProperty(t)){var e=o.routes[t];if(o.testRoute(e)){o.activeRoute.active=!1,e.active=!0,o.activeRoute=e,require([e.moduleId],function(t){e.active&&o.fire("routeload",t,o.routeArguments(e,window.location.href))});break}}return o},testRoute:function(t,e){var n=o.urlPath(e||window.location.href);if(t.path===n||"*"===t.path)return!0;if(t.path instanceof RegExp)return t.path.test(n);if(-1===t.path.indexOf("*")&&-1===t.path.indexOf(":"))return!1;var r=n.split("/"),i=t.path.split("/");if(r.length!==i.length)return!1;for(var a in i)if(i.hasOwnProperty(a)){var u=i[a];if(u!==r[a]&&"*"!==u&&":"!==u.charAt(0))return!1}return!0},routeArguments:function(t,e){t||(t=o.activeRoute),e||(e=window.location.href);var n={},r=o.urlPath(e),i=r.split("/"),a=[];!t||!t.path||t.path instanceof RegExp||(a=t.path.split("/"));for(var u in a)if(a.hasOwnProperty(u)){var s=a[u];":"===s.charAt(0)&&(n[s.substring(1)]=i[u])}var f=e.indexOf("?"),h="";if(-1!==f){h=e.substring(f);var c=h.indexOf("#");-1!==c&&(h=h.substring(0,c))}var p=e.indexOf("#/"),d=e.indexOf("#!/");if(-1!==p||-1!==d){var l="";l=e.substring(-1!==p?p:d),f=l.indexOf("?"),-1!==f&&(h=l.substring(f))}var v=h.substring(1).split("&");1===v.length&&""===v[0]&&(v=[]);for(var g in v)if(v.hasOwnProperty(g)){var w=v[g],O=w.split("=");n[O[0]]=O.splice(1,O.length-1).join("=")}for(var R in n){var b=n[R];n[R]="true"===b?!0:"false"===b?!1:isNaN(b)||""===b?decodeURIComponent(b):+b}return n},urlPath:function(e){if("undefined"!=typeof t[e])return t[e];var n=e.split("/"),r="/"+n.splice(3,n.length-3).join("/"),i=r.split(/[\?#]/)[0],a=r.indexOf("#");if(-1!==a){var o=r.substring(a).split("?")[0];"#/"===o.substring(0,2)?i=o.substring(1):"#!/"===o.substring(0,3)&&(i=o.substring(2))}return t[e]=i,i}};return o});