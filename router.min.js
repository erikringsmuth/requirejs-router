define([],function(){"use strict";var t={},e={statechange:[],routeload:[]},n=function(){r.fire("statechange")},r={init:function(t){return"undefined"==typeof t&&(t={}),window.addEventListener?window.history&&window.history.pushState?window.addEventListener("popstate",n,!1):window.addEventListener("hashchange",n,!1):window.history&&window.history.pushState?window.attachEvent("popstate",n):window.attachEvent("onhashchange",n),t.loadCurrentRouteOnStateChange!==!1&&r.on("statechange",function(){r.loadCurrentRoute()}),t.triggerInitialStateChange!==!1&&r.fire("statechange"),r},registerRoutes:function(t){for(var e in t)t.hasOwnProperty(e)&&(r.routes[e]=t[e]);return r},routes:{},activeRoute:{},on:function(t,n){return"undefined"==typeof e[t]&&(e[t]=[]),e[t].push(n),r},fire:function(t){if(e[t])for(var n=Array.prototype.slice.call(arguments,1),i=0;i<e[t].length;i++)e[t][i].apply(r,n)},off:function(t,n){if(e[t]){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}},loadCurrentRoute:function(){for(var t in r.routes)if(r.routes.hasOwnProperty(t)){var e=r.routes[t];if(r.testRoute(e)){r.activeRoute.active=!1,e.active=!0,r.activeRoute=e,require([e.moduleId],function(t){e.active&&r.fire("routeload",t,r.routeArguments(e,window.location.href))});break}}return r},testRoute:function(t,e){var n=r.urlPath(e||window.location.href);if(t.path===n||"*"===t.path)return!0;if(t.path instanceof RegExp)return t.path.test(n);if(-1===t.path.indexOf("*")&&-1===t.path.indexOf(":"))return!1;var i=n.split("/"),a=t.path.split("/");if(i.length!==a.length)return!1;for(var o in a)if(a.hasOwnProperty(o)){var s=a[o];if(s!==i[o]&&"*"!==s&&":"!==s.charAt(0))return!1}return!0},routeArguments:function(t,e){t||(t=r.activeRoute),e||(e=window.location.href);var n={},i=r.urlPath(e),a=i.split("/"),o=[];!t||!t.path||t.path instanceof RegExp||(o=t.path.split("/"));for(var s in o)if(o.hasOwnProperty(s)){var u=o[s];":"===u.charAt(0)&&(n[u.substring(1)]=a[s])}var f=e.indexOf("?"),h="";if(-1!==f){h=e.substring(f);var p=h.indexOf("#");-1!==p&&(h=h.substring(0,p))}var d=e.indexOf("#/"),c=e.indexOf("#!/");if(-1!==d||-1!==c){var l="";l=e.substring(-1!==d?d:c),f=l.indexOf("?"),-1!==f&&(h=l.substring(f))}var v=h.substring(1).split("&");1===v.length&&""===v[0]&&(v=[]);for(var g in v)if(v.hasOwnProperty(g)){var w=v[g],y=w.split("=");n[y[0]]=y.splice(1,y.length-1).join("=")}for(var O in n){var R=n[O];n[O]="true"===R?!0:"false"===R?!1:isNaN(R)||""===R?decodeURIComponent(R):+R}return n},urlPath:function(e){if("undefined"!=typeof t[e])return t[e];var n=e.split("/"),r="/"+n.splice(3,n.length-3).join("/"),i=r.split(/[\?#]/)[0],a=r.indexOf("#");if(-1!==a){var o=r.substring(a).split("?")[0];"#/"===o.substring(0,2)?i=o.substring(1):"#!/"===o.substring(0,3)&&(i=o.substring(2))}return t[e]=i,i}};return r});