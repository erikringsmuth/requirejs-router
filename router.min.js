define([],function(){"use strict";var t={},e={statechange:[],routeload:[]},n="",r=function(){n!=window.location.href&&(n=window.location.href,i.fire("statechange"))},i={init:function(t){return"undefined"==typeof t&&(t={}),window.addEventListener?(window.addEventListener("popstate",r,!1),window.addEventListener("hashchange",r,!1)):(window.attachEvent("popstate",r),window.attachEvent("onhashchange",r)),t.loadCurrentRouteOnStateChange!==!1&&i.on("statechange",function(){i.loadCurrentRoute()}),t.fireInitialStateChange!==!1&&i.fire("statechange"),i},routes:{},activeRoute:{},registerRoutes:function(t){for(var e in t)t.hasOwnProperty(e)&&(i.routes[e]=t[e]);return i},on:function(t,n){return"undefined"==typeof e[t]&&(e[t]=[]),e[t].push(n),i},fire:function(t){if(e[t])for(var n=Array.prototype.slice.call(arguments,1),r=0;r<e[t].length;r++)e[t][r].apply(i,n);return i},off:function(t,n){if(e[t]){var r=e[t].indexOf(n);-1!==r&&e[t].splice(r,1)}return i},loadCurrentRoute:function(){for(var t in i.routes)if(i.routes.hasOwnProperty(t)){var e=i.routes[t];if(i.testRoute(e)){i.activeRoute.active=!1,e.active=!0,i.activeRoute=e,require([e.moduleId],function(t){e.active&&i.fire("routeload",t,i.routeArguments(e,window.location.href))});break}}return i},urlPath:function(e){if("undefined"!=typeof t[e])return t[e];var n=e.split("/"),r="/"+n.splice(3,n.length-3).join("/"),i=r.split(/[\?#]/)[0],a=r.indexOf("#");if(-1!==a){var o=r.substring(a).split("?")[0];"#/"===o.substring(0,2)?i=o.substring(1):"#!/"===o.substring(0,3)&&(i=o.substring(2))}return t[e]=i,i},testRoute:function(t,e){var n=i.urlPath(e||window.location.href);if(t.path===n||"*"===t.path)return!0;if(t.path instanceof RegExp)return t.path.test(n);if(-1===t.path.indexOf("*")&&-1===t.path.indexOf(":"))return!1;var r=n.split("/"),a=t.path.split("/");if(r.length!==a.length)return!1;for(var o in a)if(a.hasOwnProperty(o)){var u=a[o];if(u!==r[o]&&"*"!==u&&":"!==u.charAt(0))return!1}return!0},routeArguments:function(t,e){t||(t=i.activeRoute),e||(e=window.location.href);var n={},r=i.urlPath(e),a=r.split("/"),o=[];!t||!t.path||t.path instanceof RegExp||(o=t.path.split("/"));for(var u in o)if(o.hasOwnProperty(u)){var s=o[u];":"===s.charAt(0)&&(n[s.substring(1)]=a[u])}var f=e.indexOf("?"),h="";if(-1!==f){h=e.substring(f);var c=h.indexOf("#");-1!==c&&(h=h.substring(0,c))}var p=e.indexOf("#/"),d=e.indexOf("#!/");if(-1!==p||-1!==d){var l="";l=e.substring(-1!==p?p:d),f=l.indexOf("?"),-1!==f&&(h=l.substring(f))}var v=h.substring(1).split("&");1===v.length&&""===v[0]&&(v=[]);for(var g in v)if(v.hasOwnProperty(g)){var w=v[g],O=w.split("=");n[O[0]]=O.splice(1,O.length-1).join("=")}for(var R in n){var b=n[R];n[R]="true"===b?!0:"false"===b?!1:isNaN(b)||""===b?decodeURIComponent(b):+b}return n}};return i});